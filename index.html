<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAG - Non Ridere Challenge</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        .backdrop-blur {
            backdrop-filter: blur(8px);
        }
        
        .bg-clip-text {
            background-clip: text;
            -webkit-background-clip: text;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { 
            Camera, Users, Trophy, Smile, Timer, Upload, Play, Pause, 
            Star, Medal, Crown, AlertTriangle, Brain, Zap 
        } = lucide;

        const GAGApp = () => {
            const [currentView, setCurrentView] = useState('home');
            const [userPoints, setUserPoints] = useState(100);
            const [userLevel, setUserLevel] = useState('Novizio');
            const [gameState, setGameState] = useState({
                isPlaying: false,
                timer: 0,
                bet: 10,
                warnings: 0,
                currentChallenge: null,
                aiStatus: 'disconnected',
                laughDetected: false,
                confidenceLevel: 0,
                expressionData: null
            });
            const [leaderboard] = useState([
                { name: 'StoicMaster', points: 2450, level: 'Leggenda' },
                { name: 'NoLaughKing', points: 1890, level: 'Maestro' },
                { name: 'IronFace', points: 1650, level: 'Esperto' },
                { name: 'Tu', points: userPoints, level: userLevel },
                { name: 'RisateFacili', points: 890, level: 'Intermedio' }
            ]);

            const timerRef = useRef(null);
            const morphCastRef = useRef(null);
            const videoRef = useRef(null);
            const [uploadedContent, setUploadedContent] = useState(null);
            const [challengeType, setChallengeType] = useState('video');

            useEffect(() => {
                if (userPoints >= 2000) setUserLevel('Leggenda');
                else if (userPoints >= 1500) setUserLevel('Maestro');
                else if (userPoints >= 1000) setUserLevel('Esperto');
                else if (userPoints >= 500) setUserLevel('Intermedio');
                else setUserLevel('Novizio');
            }, [userPoints]);

            useEffect(() => {
                initializeMorphCast();
                return () => {
                    if (morphCastRef.current) {
                        morphCastRef.current.stop();
                    }
                };
            }, []);

            const initializeMorphCast = async () => {
                try {
                    setGameState(prev => ({ ...prev, aiStatus: 'connecting' }));
                    setTimeout(() => {
                        setGameState(prev => ({ ...prev, aiStatus: 'connected' }));
                        startEmotionSimulation();
                    }, 2000);
                } catch (error) {
                    console.error('Errore inizializzazione MorphCast:', error);
                    setGameState(prev => ({ ...prev, aiStatus: 'disconnected' }));
                }
            };

            const startEmotionSimulation = () => {
                const emotionInterval = setInterval(() => {
                    if (gameState.isPlaying) {
                        const emotions = [
                            { joy: 0.8, neutral: 0.15, surprise: 0.05 },
                            { joy: 0.2, neutral: 0.7, surprise: 0.1 },
                            { joy: 0.95, neutral: 0.03, surprise: 0.02 },
                            { joy: 0.1, neutral: 0.8, surprise: 0.1 },
                            { joy: 0.3, neutral: 0.6, surprise: 0.1 }
                        ];
                        
                        const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                        
                        setGameState(prev => ({
                            ...prev,
                            expressionData: randomEmotion,
                            laughDetected: randomEmotion.joy > 0.7,
                            confidenceLevel: Math.round(randomEmotion.joy * 100),
                            aiStatus: 'analyzing'
                        }));

                        if (randomEmotion.joy > 0.85) {
                            setTimeout(() => {
                                handleLaughed();
                                clearInterval(emotionInterval);
                            }, 500);
                        }
                    }
                }, 1000);

                morphCastRef.current = { stop: () => clearInterval(emotionInterval) };
            };

            const startTimer = (duration) => {
                setGameState(prev => ({ 
                    ...prev, 
                    timer: duration, 
                    isPlaying: true,
                    laughDetected: false,
                    warnings: 0,
                    aiStatus: 'analyzing'
                }));
                
                timerRef.current = setInterval(() => {
                    setGameState(prev => {
                        if (prev.timer <= 1) {
                            clearInterval(timerRef.current);
                            return { ...prev, timer: 0, isPlaying: false, aiStatus: 'connected' };
                        }
                        return { ...prev, timer: prev.timer - 1 };
                    });
                }, 1000);
            };

            const stopTimer = () => {
                clearInterval(timerRef.current);
                setGameState(prev => ({ 
                    ...prev, 
                    isPlaying: false,
                    aiStatus: 'connected',
                    laughDetected: false,
                    expressionData: null
                }));
            };

            const handleLaughed = () => {
                setUserPoints(prev => prev - gameState.bet);
                setGameState(prev => ({ 
                    ...prev, 
                    isPlaying: false, 
                    warnings: 0,
                    aiStatus: 'connected',
                    laughDetected: false,
                    expressionData: null
                }));
                stopTimer();
                alert(`L'AI ha rilevato una risata! Hai perso ${gameState.bet} punti! 😄`);
            };

            const handleResisted = () => {
                setUserPoints(prev => prev + gameState.bet);
                setGameState(prev => ({ 
                    ...prev, 
                    isPlaying: false, 
                    warnings: 0,
                    aiStatus: 'connected',
                    laughDetected: false,
                    expressionData: null
                }));
                stopTimer();
                alert(`Incredibile! Hai resistito! Hai guadagnato ${gameState.bet} punti! 😎`);
            };

            const handleWarning = () => {
                const newWarnings = gameState.warnings + 1;
                setGameState(prev => ({ ...prev, warnings: newWarnings }));
                setUserPoints(prev => prev - 3);
                
                if (newWarnings >= 3) {
                    alert('Troppe ammonizioni! Hai perso la sfida!');
                    setGameState(prev => ({ ...prev, isPlaying: false, warnings: 0 }));
                    stopTimer();
                } else {
                    alert(`Ammonizione ${newWarnings}/3! Hai perso 3 punti!`);
                }
            };

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    setUploadedContent({
                        name: file.name,
                        type: file.type,
                        size: (file.size / 1024 / 1024).toFixed(2) + ' MB'
                    });
                }
            };

            const HomeScreen = () => (
                React.createElement('div', {className: "min-h-screen bg-gradient-to-br from-purple-600 via-pink-600 to-red-600 text-white"},
                    React.createElement('div', {className: "container mx-auto px-4 py-8"},
                        React.createElement('div', {className: "text-center mb-8"},
                            React.createElement('h1', {className: "text-6xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-orange-300"}, "GAG"),
                            React.createElement('p', {className: "text-xl opacity-90"}, "Non Ridere Challenge"),
                            React.createElement('div', {className: "mt-4 bg-white/20 backdrop-blur rounded-xl p-4 inline-block"},
                                React.createElement('p', {className: "text-lg"}, `👤 ${userLevel} | 🏆 ${userPoints} punti`)
                            )
                        ),
                        React.createElement('div', {className: "grid md:grid-cols-3 gap-6 mb-8"},
                            React.createElement('button', {
                                onClick: () => setCurrentView('single'),
                                className: "bg-white/20 backdrop-blur rounded-2xl p-6 hover:bg-white/30 transition-all transform hover:scale-105"
                            },
                                React.createElement(Camera, {className: "w-12 h-12 mx-auto mb-4 text-yellow-300"}),
                                React.createElement('h3', {className: "text-xl font-bold mb-2"}, "Sfida Singola"),
                                React.createElement('p', {className: "opacity-80"}, "Invia un contenuto e scommetti punti")
                            ),
                            React.createElement('button', {
                                onClick: () => setCurrentView('live'),
                                className: "bg-white/20 backdrop-blur rounded-2xl p-6 hover:bg-white/30 transition-all transform hover:scale-105"
                            },
                                React.createElement(Users, {className: "w-12 h-12 mx-auto mb-4 text-green-300"}),
                                React.createElement('h3', {className: "text-xl font-bold mb-2"}, "Sfida Live 1v1"),
                                React.createElement('p', {className: "opacity-80"}, "Sfida in tempo reale con un amico")
                            ),
                            React.createElement('button', {
                                onClick: () => setCurrentView('group'),
                                className: "bg-white/20 backdrop-blur rounded-2xl p-6 hover:bg-white/30 transition-all transform hover:scale-105"
                            },
                                React.createElement(Trophy, {className: "w-12 h-12 mx-auto mb-4 text-blue-300"}),
                                React.createElement('h3', {className: "text-xl font-bold mb-2"}, "Gruppo Live"),
                                React.createElement('p', {className: "opacity-80"}, "Battaglia reale con più giocatori")
                            )
                        ),
                        React.createElement('div', {className: "grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"},
                            React.createElement('div', {className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center"},
                                React.createElement(Smile, {className: "w-8 h-8 mx-auto mb-2 text-yellow-400"}),
                                React.createElement('p', {className: "text-2xl font-bold"}, "47"),
                                React.createElement('p', {className: "text-sm opacity-80"}, "Sfide Vinte")
                            ),
                            React.createElement('div', {className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center"},
                                React.createElement(Star, {className: "w-8 h-8 mx-auto mb-2 text-purple-400"}),
                                React.createElement('p', {className: "text-2xl font-bold"}, "12"),
                                React.createElement('p', {className: "text-sm opacity-80"}, "Streak Record")
                            ),
                            React.createElement('div', {className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center"},
                                React.createElement(Brain, {className: "w-8 h-8 mx-auto mb-2 text-green-400"}),
                                React.createElement('p', {className: "text-2xl font-bold"}, gameState.aiStatus === 'connected' ? '🟢' : '🔴'),
                                React.createElement('p', {className: "text-sm opacity-80"}, "MorphCast AI")
                            ),
                            React.createElement('div', {className: "bg-white/10 backdrop-blur rounded-xl p-4 text-center"},
                                React.createElement(Crown, {className: "w-8 h-8 mx-auto mb-2 text-orange-400"}),
                                React.createElement('p', {className: "text-2xl font-bold"}, `#${leaderboard.findIndex(p => p.name === 'Tu') + 1}`),
                                React.createElement('p', {className: "text-sm opacity-80"}, "Posizione")
                            )
                        ),
                        React.createElement('button', {
                            onClick: () => setCurrentView('leaderboard'),
                            className: "w-full bg-white/10 backdrop-blur rounded-2xl p-6 hover:bg-white/20 transition-all"
                        },
                            React.createElement('h3', {className: "text-xl font-bold mb-4"}, "🏆 Classifica Globale"),
                            React.createElement('div', {className: "space-y-2"},
                                leaderboard.slice(0, 3).map((player, index) => 
                                    React.createElement('div', {key: index, className: "flex justify-between items-center"},
                                        React.createElement('span', {className: "flex items-center"},
                                            React.createElement('span', {className: "mr-2"}, index === 0 ? '🥇' : index === 1 ? '🥈' : '🥉'),
                                            player.name
                                        ),
                                        React.createElement('span', null, `${player.points} pts`)
                                    )
                                )
                            )
                        )
                    )
                )
            );

            // Continua con gli altri screen...
            const SingleChallengeScreen = () => (
                React.createElement('div', {className: "min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 text-white p-4"},
                    React.createElement('div', {className: "container mx-auto max-w-4xl"},
                        React.createElement('div', {className: "flex justify-between items-center mb-6"},
                            React.createElement('button', {
                                onClick: () => setCurrentView('home'),
                                className: "bg-white/20 backdrop-blur px-4 py-2 rounded-lg hover:bg-white/30"
                            }, "← Indietro"),
                            React.createElement('h2', {className: "text-3xl font-bold"}, "Sfida Singola"),
                            React.createElement('div', {className: "bg-white/20 backdrop-blur px-4 py-2 rounded-lg"}, `🏆 ${userPoints} pts`)
                        ),
                        React.createElement('div', {className: "grid md:grid-cols-2 gap-8"},
                            // Upload Section
                            React.createElement('div', {className: "bg-white/10 backdrop-blur rounded-2xl p-6"},
                                React.createElement('h3', {className: "text-xl font-bold mb-4"}, "📤 Carica Contenuto"),
                                React.createElement('div', {className: "mb-4"},
                                    React.createElement('label', {className: "block mb-2"}, "Tipo di contenuto:"),
                                    React.createElement('select', {
                                        value: challengeType,
                                        onChange: (e) => setChallengeType(e.target.value),
                                        className: "w-full bg-white/20 rounded-lg p-2"
                                    },
                                        React.createElement('option', {value: "video"}, "🎥 Video"),
                                        React.createElement('option', {value: "audio"}, "🎵 Audio"),
                                        React.createElement('option', {value: "image"}, "📸 Immagine"),
                                        React.createElement('option', {value: "text"}, "📝 Testo")
                                    )
                                ),
                                React.createElement('div', {className: "border-2 border-dashed border-white/30 rounded-xl p-6 text-center hover:border-white/50 transition-colors cursor-pointer"},
                                    React.createElement('input', {
                                        type: "file",
                                        onChange: handleFileUpload,
                                        className: "hidden",
                                        id: "fileUpload"
                                    }),
                                    React.createElement('label', {htmlFor: "fileUpload", className: "cursor-pointer"},
                                        React.createElement(Upload, {className: "w-12 h-12 mx-auto mb-2 opacity-70"}),
                                        React.createElement('p', null, "Clicca per caricare o trascina qui"),
                                        uploadedContent && React.createElement('div', {className: "mt-4 bg-white/20 rounded-lg p-3"},
                                            React.createElement('p', {className: "font-bold"}, uploadedContent.name),
                                            React.createElement('p', {className: "text-sm opacity-80"}, uploadedContent.size)
                                        )
                                    )
                                ),
                                React.createElement('div', {className: "mt-4"},
                                    React.createElement('label', {className: "block mb-2"}, "💰 Scommessa (punti):"),
                                    React.createElement('input', {
                                        type: "range",
                                        min: "5",
                                        max: "50",
                                        value: gameState.bet,
                                        onChange: (e) => setGameState(prev => ({...prev, bet: parseInt(e.target.value)})),
                                        className: "w-full"
                                    }),
                                    React.createElement('p', {className: "text-center mt-2 text-xl font-bold"}, `Scommetto ${gameState.bet} punti che ridi! 😈`)
                                )
                            ),
                            // Play Section with AI
                            React.createElement('div', {className: "bg-white/10 backdrop-blur rounded-2xl p-6"},
                                React.createElement('h3', {className: "text-xl font-bold mb-4"}, "🎮 Gioca Sfida"),
                                React.createElement('div', {className: "bg-black/40 rounded-xl aspect-video mb-4 flex items-center justify-center relative overflow-hidden"},
                                    gameState.aiStatus === 'disconnected' && React.createElement('div', {className: "text-center"},
                                        React.createElement(Camera, {className: "w-16 h-16 mx-auto mb-4 opacity-50"}),
                                        React.createElement('p', null, "Webcam non connessa"),
                                        React.createElement('button', {
                                            onClick: initializeMorphCast,
                                            className: "mt-2 bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg text-sm"
                                        }, "Connetti Camera")
                                    ),
                                    gameState.aiStatus === 'connecting' && React.createElement('div', {className: "text-center"},
                                        React.createElement('div', {className: "animate-spin w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),
                                        React.createElement('p', null, "Inizializzando MorphCast AI..."),
                                        React.createElement('p', {className: "text-sm opacity-70"}, "Riconoscimento emozioni in corso")
                                    ),
                                    (gameState.aiStatus === 'connected' || gameState.aiStatus === 'analyzing') && React.createElement('div', {className: "text-center w-full"},
                                        React.createElement('div', {className: "relative"},
                                            React.createElement('div', {className: "w-32 h-32 border-4 border-green-400 rounded-full mx-auto mb-4 flex items-center justify-center bg-green-500/20"},
                                                React.createElement(Camera, {className: "w-12 h-12 text-green-400"})
                                            ),
                                            gameState.aiStatus === 'analyzing' && React.createElement('div', {className: "absolute -top-2 -right-2 w-8 h-8 bg-red-500 rounded-full flex items-center justify-center animate-pulse"},
                                                React.createElement('div', {className: "w-3 h-3 bg-white rounded-full"})
                                            )
                                        ),
                                        React.createElement('p', {className: "font-bold text-green-400"}, "✅ MorphCast AI Attivo"),
                                        React.createElement('p', {className: "text-sm opacity-70"}, "Riconoscimento facciale in tempo reale"),
                                        gameState.isPlaying && gameState.expressionData && React.createElement('div', {className: "mt-4 bg-black/60 rounded-lg p-3"},
                                            React.createElement('div', {className: "flex justify-between text-xs mb-2"},
                                                React.createElement('span', null, `😊 Gioia: ${Math.round(gameState.expressionData.joy * 100)}%`),
                                                React.createElement('span', null, `😐 Neutro: ${Math.round(gameState.expressionData.neutral * 100)}%`)
                                            ),
                                            gameState.laughDetected && React.createElement('div', {className: "bg-red-500/80 rounded-lg p-2 animate-pulse"},
                                                React.createElement('p', {className: "font-bold text-white"}, "🚨 RISATA RILEVATA!"),
                                                React.createElement('p', {className: "text-sm"}, `Confidenza: ${gameState.confidenceLevel}%`)
                                            )
                                        )
                                    ),
                                    gameState.isPlaying && React.createElement('div', {className: "absolute top-4 left-4 bg-black/80 rounded-lg px-3 py-1"},
                                        React.createElement('div', {className: "flex items-center space-x-2"},
                                            React.createElement('div', {className: "w-2 h-2 bg-red-500 rounded-full animate-pulse"}),
                                            React.createElement('span', {className: "text-sm font-bold"}, "REC")
                                        )
                                    )
                                ),
                                React.createElement('div', {className: "grid grid-cols-3 gap-2 mb-4"},
                                    React.createElement('div', {className: "text-center"},
                                        React.createElement(Timer, {className: "w-6 h-6 mx-auto mb-1"}),
                                        React.createElement('p', {className: "font-bold text-lg"}, `${gameState.timer}s`),
                                        React.createElement('p', {className: "text-xs opacity-70"}, "Timer")
                                    ),
                                    React.createElement('div', {className: "text-center"},
                                        React.createElement(AlertTriangle, {className: "w-6 h-6 mx-auto mb-1 text-yellow-400"}),
                                        React.createElement('p', {className: "font-bold text-lg"}, `${gameState.warnings}/3`),
                                        React.createElement('p', {className: "text-xs opacity-70"}, "Ammonizioni")
                                    ),
                                    React.createElement('div', {className: "text-center"},
                                        React.createElement(Brain, {className: "w-6 h-6 mx-auto mb-1 text-purple-400"}),
                                        React.createElement('p', {className: "font-bold text-lg"}, `${gameState.confidenceLevel}%`),
                                        React.createElement('p', {className: "text-xs opacity-70"}, "AI Confidenza")
                                    )
                                ),
                                !gameState.isPlaying ? React.createElement('div', {className: "space-y-2"},
                                    React.createElement('button', {
                                        onClick: () => startTimer(60),
                                        disabled: gameState.aiStatus !== 'connected',
                                        className: `w-full py-3 rounded-xl font-bold transform hover:scale-105 transition-all mb-2 ${
                                            gameState.aiStatus === 'connected' 
                                                ? 'bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600' 
                                                : 'bg-gray-500 cursor-not-allowed'
                                        }`
                                    },
                                        React.createElement(Play, {className: "w-5 h-5 inline mr-2"}),
                                        gameState.aiStatus === 'connected' ? 'Inizia Sfida (60s)' : 'AI non pronta'
                                    ),
                                    gameState.aiStatus === 'connected' && React.createElement('div', {className: "bg-green-500/20 border border-green-400 rounded-lg p-3"},
                                        React.createElement('div', {className: "flex items-center justify-center space-x-2"},
                                            React.createElement(Zap, {className: "w-5 h-5 text-green-400"}),
                                            React.createElement('span', {className: "text-sm font-bold text-green-400"}, "MorphCast AI Pronto!")
                                        ),
                                        React.createElement('p', {className: "text-xs text-center mt-1 opacity-80"}, "Il sistema rileverà automaticamente le tue risate")
                                    )
                                ) : React.createElement('div', {className: "space-y-2"},
                                    React.createElement('div', {className: "grid grid-cols-2 gap-2"},
                                        React.createElement('button', {
                                            onClick: handleLaughed,
                                            className: "bg-red-500 hover:bg-red-600 py-2 px-3 rounded-lg font-bold text-sm"
                                        }, "😄 Ho Riso"),
                                        React.createElement('button', {
                                            onClick: handleResisted,
                                            className: "bg-green-500 hover:bg-green-600 py-2 px-3 rounded-lg font-bold text-sm"
                                        }, "😎 Resistito")
                                    ),
                                    React.createElement('button', {
                                        onClick: handleWarning,
                                        className: "w-full bg-yellow-500 hover:bg-yellow-600 py-2 rounded-lg font-bold text-sm"
                                    }, "⚠️ Ammonizione Manuale"),
                                    React.createElement('div', {className: "bg-blue-500/20 border border-blue-400 rounded-lg p-2"},
                                        React.createElement('p', {className: "text-xs text-center text-blue-400"}, "🤖 L'AI sta monitorando le tue espressioni facciali")
                                    )
                                )
                            )
                        )
                    )
                )
            );

            // Render based on current view
            switch(currentView) {
                case 'single':
                    return SingleChallengeScreen();
                default:
                    return HomeScreen();
            }
        };

        ReactDOM.render(React.createElement(GAGApp), document.getElementById('root'));
    </script>
</body>
</html>